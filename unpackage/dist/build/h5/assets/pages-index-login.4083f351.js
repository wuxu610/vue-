import{x as e,y as a,z as s,o,j as l,d as n,w as i,F as t,g as r,f as u,A as c,v as p,B as d,C as m,D as f,r as g,E as _}from"./index-1a6584d6.js";import{_ as y,a as x}from"./uni-forms.2040be4c.js";import{r as v}from"./uni-app.es.370722fd.js";import{_ as h}from"./uni-forms-item.c9c83eea.js";import{_ as j,a as w,b as k}from"./uni-popup-dialog.d097575b.js";import{_ as V}from"./logo.04cf753c.js";import{p as z}from"./index.887f33b8.js";import{_ as b}from"./_plugin-vue_export-helper.1b428a4d.js";import"./uni-icons.ed853b65.js";const C=b({__name:"login",setup(b){const C=e(),D=a(null),E=s({email:"",password:""}),I=a(null),O=a(null),U=a(null),q=a(null),F=a(null),N={email:{rules:[{required:!0,errorMessage:"必填项"},{format:"email",errorMessage:"邮件格式错误"}]}},P=()=>{D.value.validate().then((e=>{z("api/mobile/elogin",E).then((e=>{if(console.log(e),e.success){const a=e.data.userinfo;C.setToken(a.token),C.fillUser(a),c({url:"/pages/index/index"})}})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))};function R(){p({url:"/pages/index/register",success(e){console.log(e)},fail(e){console.log(e)}})}function T(){c({url:"/pages/index/index"})}function M(e,a){O.value=e,U.value=a,F.value.open()}async function S(){try{const a=await uni.getSetting();console.log(a),a.authSetting["scope.userInfo"]?M("success","用户已授权"):M("error","用户未授权");const s=await uni.getUserProfile({desc:"用户登录授权",lang:"zh_CN"});if(console.log(s),s){const a=await d({provider:"weixin"});if(a){const{code:s}=a,{data:o}=await m({url:`https://api.weixin.qq.com/sns/jscode2session?appid=wxbd29d8cc5741b068&secret=1010c1a8363aa1b5a90ac09f7d0905b3&js_code=${s}&grant_type=authorization_code`});console.log("==========用户OPEN ID=========="),console.log(o),I.value=o.openid,e="success",O.value=e,q.value.open()}}else M("error","用户取消授权")}catch(a){console.log("============EORROR=========="),console.log(a)}var e}return(e,a)=>{const s=f,c=r,p=v(g("uni-easyinput"),y),d=v(g("uni-forms-item"),h),m=_,z=v(g("uni-forms"),x),b=v(g("uni-popup-message"),j),C=v(g("uni-popup"),w),M=v(g("uni-popup-dialog"),k);return o(),l(t,null,[n(c,null,{default:i((()=>[n(c,{class:"logo"},{default:i((()=>[n(s,{src:V})])),_:1}),n(z,{class:"myForm",ref_key:"myForm",ref:D,modelValue:E,rules:N,style:{"text-align":"center"}},{default:i((()=>[n(d,{name:"email"},{default:i((()=>[n(p,{class:"input",modelValue:E.email,"onUpdate:modelValue":a[0]||(a[0]=e=>E.email=e),placeholder:"请输入电子邮箱","suffix-icon":"email"},null,8,["modelValue"])])),_:1}),n(d,{name:"password"},{default:i((()=>[n(p,{class:"input",type:"password",modelValue:E.password,"onUpdate:modelValue":a[1]||(a[1]=e=>E.password=e),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1}),n(m,{type:"primary",onClick:P,size:"mini"},{default:i((()=>[u("用户登录")])),_:1}),n(m,{type:"primary",onClick:S,size:"mini",style:{"margin-left":"10px"}},{default:i((()=>[u("微信登录")])),_:1}),n(c,{class:"logo-extra"},{default:i((()=>[n(m,{type:"default",size:"mini"},{default:i((()=>[u("忘记密码")])),_:1}),n(m,{type:"default",size:"mini",onClick:R},{default:i((()=>[u("用户注册")])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),n(C,{ref_key:"message",ref:F,type:"message"},{default:i((()=>[n(b,{type:O.value,message:U.value,duration:2e3},null,8,["type","message"])])),_:1},512),n(C,{ref_key:"alertDialog",ref:q,type:"dialog"},{default:i((()=>[n(M,{type:O.value,cancelText:"关闭",confirmText:"确认",title:"获取得的OPEN ID",content:I.value,onConfirm:T},null,8,["type","content"])])),_:1},512)],64)}}},[["__scopeId","data-v-e779dd45"]]);export{C as default};
